{%- assign aa_section_id = section.id | split: '__' -%}
{%- assign aa_section_id = aa_section_id[1] -%}
{%- assign aa_section_id = aa_section_id | replace: '-', '_' -%}

{% render 'aa-cp-init' %}

<style>
   #shopify-section-{{ section.id }} .aa-cp-s1 {
     position: relative;
     text-align: center;
     font-family: 'Montserrat', sans-serif;
     color: #fff;
     background-color: #000;
     overflow: hidden;
   }
   #shopify-section-{{ section.id }} .aa-cp-s1 .aa-wrap {
     position: absolute;
     left: 0;
     top: 80px;
     z-index: 2;
     width: 100%;
   }
   #shopify-section-{{ section.id }} .aa-cp-s1 .aa-btn-play {
     position: absolute;
     left: 0;
     bottom: 30%;
     z-index: 3;
     width: 100%;
     display: flex;
     flex-wrap: wrap;
     flex-direction: row;
     justify-content: center;
     align-items: center;
     align-content: center;
     color: #fff;
     cursor: pointer;
   }
   #shopify-section-{{ section.id }} .aa-cp-s1 .aa-btn-play .aa-svg {
     border: 1px solid #fff;
     border-radius: 100%;
     background-color: rgba(0,0,0,0.4);
     width: 100px;
     height: 100px;
     display: flex;
     flex-wrap: wrap;
     flex-direction: row;
     justify-content: center;
     align-items: center;
     align-content: center;
     padding: 20px;
   }
   #shopify-section-{{ section.id }} .aa-cp-s1 .aa-btn-play .aa-svg svg {
     width: 60%;
     margin-left: 10px;
   }
   #shopify-section-{{ section.id }} .aa-cp-s1 .aa-head {
     text-align: center;
     line-height: 1;
   }
   #shopify-section-{{ section.id }} .aa-cp-s1 .aa-head .aa-heading {
     font-size: {{ section.settings.heading_size }};
     font-weight: 700;
     text-transform: uppercase;
     color: inherit;
     padding: 10px 0;
     {%- if section.settings.heading_bgimg != blank -%}
     background-clip: text;
     -webkit-background-clip: text;
     -webkit-text-fill-color: transparent;
     -webkit-font-smoothing: antialiased;
     background-image: url('{{ section.settings.heading_bgimg | img_url: 'master' }}');
     background-size: 100% 100%;
     color: transparent;
     {%- endif -%}
   }
   #shopify-section-{{ section.id }} .aa-cp-s1 .aa-head .aa-subheading {
     font-size: {{ section.settings.subheading_size }};
     font-weight: 500;
     color: inherit;
   }
   #shopify-section-{{ section.id }} .aa-cp-s1 .aa-info {
     line-height: 1.2;
     color: inherit;
   }
   #shopify-section-{{ section.id }} .aa-cp-s1 .aa-video-player {
    position: absolute;
    z-index: 5;
    width: 100%;
    height: 100%;
  }
  #shopify-section-{{ section.id }} .aa-cp-s1 .aa-video-player video {
    width: 100%;
    height: 100%;
    position: absolute;
    object-fit: cover;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    z-index: 4;
  }
  #shopify-section-{{ section.id }} .aa-cp-s1 .aa-button {
    text-align: center;
  }
  #shopify-section-{{ section.id }} .aa-cp-s1 .aa-button a {
    display: inline-block;
    padding: 10px 30px;
    margin-top: 15px;
    font-size: {{ section.settings.button_size }};
    font-weight: 700;
    color: inherit;
    background-color: #9921CF;
    text-decoration: none;
  }
  
   @media screen and (min-width: 768px) {
     #shopify-section-{{ section.id }} .aa-cp-s1 .aa-info {
       font-size: {{ section.settings.info_size }};
     }
     #shopify-section-{{ section.id }} .aa-cp-s1 .aa-image {
       position: absolute;
       bottom: 0;
       left: 0;
       width: 100%;
       height: 60%;
       line-height: 0;
       display: flex;
       text-align: center;
     }
     #shopify-section-{{ section.id }} .aa-cp-s1 .aa-image img {
       vertical-align: bottom;
       margin-left: auto;
       margin-right: auto;
     }
   }
   @media screen and (max-width: 767px) {
     #shopify-section-{{ section.id }} .aa-cp-s1 .aa-wrap {
       height: 100%;
       top: 0;
       padding-top: 30px;
       padding-bottom: 20px;
       display: flex;
       flex-direction: column;
       justify-content: space-between;
     }
     #shopify-section-{{ section.id }} .aa-cp-s1 .aa-head .aa-heading {
       {%- if section.settings.heading_bgimg_mobile != blank -%}
       background-image: url('{{ section.settings.heading_bgimg_mobile | img_url: 'master' }}');
       background-size: 100% 100%;
       {%- endif -%}
       padding-top: 30px;
       padding-bottom: 10px;
     }
     #shopify-section-{{ section.id }} .aa-cp-s1 .aa-head .aa-heading {
       font-size: {{ section.settings.heading_size_mobile }};
     }
     #shopify-section-{{ section.id }} .aa-cp-s1 .aa-head .aa-subheading {
       font-size: {{ section.settings.subheading_size_mobile }};
       font-weight: 700;
     }
     #shopify-section-{{ section.id }} .aa-cp-s1 .aa-info {
       font-size: {{ section.settings.info_size_mobile }};
       padding: 0 25px;
       line-height: 1.4;
     }
     #shopify-section-{{ section.id }} .aa-cp-s1 .aa-button a {
       font-size: {{ section.settings.button_size_mobile }};
     }
   }
</style>

<div class="aa-section aa-cp-s1 aa-w1920">
  <div class="aa-desktop aa-relative">
    {%- if section.settings.video_url != blank -%}
      <div class="aa-video-player" style="display:none">
        {%- if section.settings.video_url != blank -%}
          <video class="aa-desktop aa-video" controls playsinline>
            <source src="{{ section.settings.video_url }}">
            Your browser doesn't support HTML5 video tag.
          </video>
        {%- endif -%}
    </div>
    {%- endif -%}
    {%- if section.settings.video_cover != blank -%}
      <div class="aa-bgimg">
        <img src="{{ section.settings.video_cover | img_url: 'master' }}">
      </div>
    {%- endif -%}

    <div class="aa-btn-play">
    <div class="aa-svg">
      <svg viewBox="-0.5 0 8 8" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-427.000000, -3765.000000)" fill="currentColor">
            <g id="icons" transform="translate(56.000000, 160.000000)">
                <polygon id="play-[#1001]" points="371 3605 371 3613 378 3609"></polygon>
            </g>
        </g>
    </g>
</svg></div>
    </div>
    
    <div class="aa-wrap">
      <div class="aa-head">
        {%- if section.settings.subheading != blank -%}
          <div class="aa-subheading" {{ settings.item_animate }}>{{ section.settings.subheading | escape }}</div>
        {%- endif -%}
        {%- if section.settings.heading != blank -%}
          <div class="aa-heading" {{ settings.item_animate }}>{{ section.settings.heading | escape }}</div>
        {%- endif -%}
        {%- if section.settings.info != blank -%}
          <div class="aa-info" {{ settings.item_animate }}>{{ section.settings.info }}</div>
        {%- endif -%}
        {%- if section.settings.button != blank and section.settings.link != blank -%}
          <div class="aa-button" {{ settings.item_animate }}>
            <a href="{{ section.settings.link }}">{{ section.settings.button | escape }}</a>
          </div>
        {%- endif -%}
      </div>
    </div>
       
      {%- if section.settings.image != blank -%}
        <div class="aa-image" {{ settings.item_animate }}>
          <img src="{{ section.settings.image | img_url: 'master' }}">
        </div>
      {%- endif -%}
  </div>

  <div class="aa-mobile aa-relative">
    {%- if section.settings.video_url_mobile != blank -%}
      <div class="aa-video-player" style="display:none">
        {%- if section.settings.video_url_mobile != blank -%}
          <video class="aa-mobile aa-video" controls playsinline>
            <source src="{{ section.settings.video_url_mobile }}">
            Your browser doesn't support HTML5 video tag.
          </video>
        {%- endif -%}
    </div>
    {%- endif -%}
    {%- if section.settings.video_cover_mobile != blank -%}
      <div class="aa-image">
        <img src="{{ section.settings.video_cover_mobile | img_url: 'master' }}">
      </div>
    {%- endif -%}
    <div class="aa-wrap">
      <div class="aa-head">
        {%- if section.settings.heading_mobile != blank -%}
          <div class="aa-heading" {{ settings.item_animate }}>{{ section.settings.heading_mobile | escape }}</div>
        {%- endif -%}
        {%- if section.settings.subheading_mobile != blank -%}
          <div class="aa-subheading" {{ settings.item_animate }}>{{ section.settings.subheading_mobile | escape }}</div>
        {%- endif -%}
        {%- if section.settings.button != blank and section.settings.link != blank -%}
          <div class="aa-button" {{ settings.item_animate }}>
            <a href="{{ section.settings.link }}">{{ section.settings.button | escape }}</a>
          </div>
        {%- endif -%}
      </div>
      {%- if section.settings.info_mobile != blank -%}
        <div class="aa-info" {{ settings.item_animate }}>{{ section.settings.info_mobile }}</div>
      {%- endif -%}
    </div>
  </div>
</div>

<script>
(function($) {
  
  $(document).on('click', '#shopify-section-{{ section.id }} .aa-btn-play', function (e) {
    var target = $('#shopify-section-{{ section.id }} .aa-relative'),
        video_{{ aa_section_id }} = target.find('.aa-video').get(0);
    
    if (video_{{ aa_section_id }}.paused === false) {
      target.find('.aa-video-player').hide();
      video_{{ aa_section_id }}.pause();
    } else {
      target.find('.aa-video-player').show();
      video_{{ aa_section_id }}.play();
    }
    $('#shopify-section-{{ section.id }} .aa-cp-s1').toggleClass('is-playing');
    return false;
  });

  var target_{{ aa_section_id }} = $('#shopify-section-{{ section.id }}');
  var video_{{ aa_section_id }} = target_{{ aa_section_id }}.find('.aa-video').get(0);
  if ($(window).width() < 768) {
    video_{{ aa_section_id }} = target_{{ aa_section_id }}.find('.aa-video').get(1);
  }

  $(window).on('resize scroll', function() {
    
    var video_{{ aa_section_id }}_visible = target_{{ aa_section_id }}.inView('bottomOnly');
    var h_{{ aa_section_id }} = $('#shopify-section-announcement').height() + $('#shopify-section-header').height() + target_{{ aa_section_id }}.height();
    if ( $(window).scrollTop() >= h_{{ aa_section_id }} ) {
      console.log('video paused');
      /*target_{{ aa_section_id }}.find('.aa-video-player').hide();*/
      video_{{ aa_section_id }}.pause();
    }
  });

  target_{{ aa_section_id }}.find('.aa-video').on('ended', function() {
    target_{{ aa_section_id }}.find('.aa-video-player').hide();
  });
  
})(jQuery);
</script>

{% schema %}
{
  "name": "AA CP S1",
  "limit": 1,
  "settings": [
    {
      "type": "image_picker",
      "id": "video_cover",
      "label": "Video Cover"
    },
    {
      "type": "image_picker",
      "id": "video_cover_mobile",
      "label": "Video Cover (mobile)"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "video_url",
      "label": "Video URL"
    },
    {
      "type": "text",
      "id": "video_url_mobile",
      "label": "Video URL (mobile)"
    },
    {
      "type": "header",
      "content": "Head"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "text",
      "id": "heading_size",
      "label": "Heading size",
      "default": "70px"
    },
    {
      "type": "image_picker",
      "id": "heading_bgimg",
      "label": "Heading background image"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Sub heading"
    },
    {
      "type": "text",
      "id": "subheading_size",
      "label": "Sub heading size",
      "default": "44px"
    },
    {
      "type": "richtext",
      "id": "info",
      "label": "Info"
    },
    {
      "type": "text",
      "id": "info_size",
      "label": "Info size",
      "default": "26px"
    },
    {
      "type": "header",
      "content": "Head (mobile)"
    },
    {
      "type": "text",
      "id": "heading_mobile",
      "label": "Heading"
    },
    {
      "type": "text",
      "id": "heading_size_mobile",
      "label": "Heading size (mobile)",
      "default": "27px"
    },
    {
      "type": "image_picker",
      "id": "heading_bgimg_mobile",
      "label": "Heading background image"
    },
    {
      "type": "text",
      "id": "subheading_mobile",
      "label": "Sub heading"
    },
    {
      "type": "text",
      "id": "subheading_size_mobile",
      "label": "Sub heading size (mobile)",
      "default": "16px"
    },
    {
      "type": "richtext",
      "id": "info_mobile",
      "label": "Info"
    },
    {
      "type": "text",
      "id": "info_size_mobile",
      "label": "Info size (mobile)",
      "default": "14px"
    },
    {
      "type": "text",
      "id": "button",
      "label": "Button",
      "default": "SHOP NOW"
    },
    {
      "type": "text",
      "id": "button_size",
      "label": "Button size",
      "default": "26px"
    },
    {
      "type": "text",
      "id": "button_size_mobile",
      "label": "Button size (mobile)",
      "default": "14px"
    },
    {
      "type": "text",
      "id": "link",
      "label": "Link",
      "default": "/products/carbon-prism-spinning-reels-ultralight-seafoam-violet"
    }
  ],
  "presets": [
    {
      "name": "AA CP S1"
    }
  ]
}
{% endschema %}
